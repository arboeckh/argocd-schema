name: Auto-Generate Alembic Migration

on:
  push:
    branches:
      - main  # Runs when code is merged into main

jobs:
  alembic-migration:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set Up Python
        uses: actions/setup-python@v3
        with:
          python-version: '3.12'

      - name: Install Dependencies
        run: |
          pip install alembic sqlalchemy psycopg2-binary

      - name: Generate Migration
        run: |
          alembic revision --autogenerate -m "Auto-generated migration"
          git config --global user.email "ci-bot@example.com"
          git config --global user.name "CI Migration Bot"

      - name: Create Pull Request for Migration
        uses: peter-evans/create-pull-request@v5
        with:
          branch: "auto-migrations"
          base: main
          title: "Auto-Generated Alembic Migration"
          body: "This PR contains an automatically generated Alembic migration."
          commit-message: "Auto-generated Alembic migration"
          labels: "database"
